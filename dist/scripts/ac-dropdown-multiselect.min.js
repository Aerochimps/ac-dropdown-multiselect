!function(){"use strict";angular.module("ac-dropdown-multiselect",[]).directive("acDropdownMultiselect",["$filter","$document",function(e,t){return{restrict:"AE",scope:{selectedModel:"=",options:"=",extraSettings:"=",events:"=",searchFilter:"=?",translationTexts:"=",groupBy:"@",useFontAwesome:"="},template:function(e,t){var n=t.groupBy?!0:!1,s=t.useFontAwesome?"i":"span",o=t.useFontAwesome?"fa":"glyphicon",l='<div class="multiselect-parent btn-group dropdown-multiselect" ng-class="{active: open && !settings.alwaysOpened}">';return l+='<button type="button" class="dropdown-toggle" ng-class="settings.buttonClasses" ng-click="toggleDropdown()">{{getButtonText()}}&nbsp;<i class="icon-down"></i></button>',l+="<ul class=\"dropdown-menu dropdown-menu-form\" ng-style=\"{display: (settings.alwaysOpened || open) ? 'block' : 'none', height : settings.scrollable ? settings.scrollableHeight : 'auto' }\" style=\"overflow: scroll\" >",l+='<li ng-hide="!settings.showCheckAll || settings.selectionLimit > 0"><a data-ng-click="selectAll()"><'+s+' class="'+o+" "+o+'-ok"></'+s+'>  <span class="intemText">{{texts.checkAll}}</span> </a>',l+='<li ng-show="settings.showUncheckAll"><a data-ng-click="deselectAll();"><'+s+' class="'+o+" "+o+'-remove"></'+s+'>   <span class="intemText">{{texts.uncheckAll}}</span> </a></li>',l+='<li ng-hide="(!settings.showCheckAll || settings.selectionLimit > 0) && !settings.showUncheckAll || settings.noSeparators" class="divider"></li>',l+='<li ng-show="settings.enableSearch"><div class="dropdown-header"><input type="text" class="form-control" style="width: 100%;" ng-model="searchFilter" placeholder="{{texts.searchPlaceholder}}" /></li>',l+='<li ng-show="settings.enableSearch && !settings.noSeparators" class="divider"></li>',l+='<li ng-show="settings.enableNewItem"><div class="dropdown-header"><input type="text" class="form-control" style="width: 100%;" ng-model="newItem" placeholder="{{texts.newItemPlaceholder}}" ng-keydown="onNewItemAddKeyDown($event)" /></li>',l+='<li ng-show="settings.enableNewItem && !settings.noSeparators" class="divider"></li>',n?(l+='<li ng-repeat-start="option in orderedItems | filter: searchFilter" ng-show="getPropertyForObject(option, settings.groupBy) !== getPropertyForObject(orderedItems[$index - 1], settings.groupBy)" role="presentation" class="dropdown-header">{{ getGroupTitle(getPropertyForObject(option, settings.groupBy)) }}</li>',l+='<li ng-repeat-end role="presentation">'):l+='<li class="presentation" role="presentation" ng-repeat="option in options | filter: searchFilter">',l+='<div class="menu-item">',l+='<div class="menu-item-status"><'+s+' class="'+o+'" data-ng-class="{\''+o+"-check icon-check': isChecked(getPropertyForObject(option,settings.idProp)), 'icon-uncheck': !isChecked(getPropertyForObject(option,settings.idProp))}\"></"+s+"></div>",l+='<div class="menu-item-label" role="menuitem" tabindex="-1" ng-click="setSelectedItem(getPropertyForObject(option,settings.idProp))">{{getPropertyForObject(option, settings.displayProp)}}</div>',l+='<div class="menu-item-edit" ng-click="showEdit($event)"><'+s+' ng-show="settings.enableEdit" class="'+o+" "+o+'-pencil icon-pencil"></'+s+"></div></div>",l+='<div class="edit-item" style="display:none">',l+='<div class="edit-item-input"><input ng-attr-id="getPropertyForObject(option,settings.idProp)" type="text" ng-value="getPropertyForObject(option, settings.displayProp)" ng-keyup="editingOption($event, getPropertyForObject(option,settings.idProp))" /></div>',l+='<div class="edit-item-remove" ng-click="removeOption($event, getPropertyForObject(option,settings.idProp))"><'+s+' class="'+o+" "+o+'-trash icon-trash"></'+s+"></div></div>",l+="</li>",l+='<li class="divider" ng-show="settings.selectionLimit > 1 && !settings.noSeparators"></li>',l+='<li role="presentation" ng-show="settings.selectionLimit > 1"><a role="menuitem">{{selectedModel.length}} {{texts.selectionOf}} {{settings.selectionLimit}} {{texts.selectionCount}}</a></li>',l+="</ul>",l+="</div>"},link:function(n,s,o){function l(e){var t={};return""===n.settings.externalIdProp?t[n.settings.idProp]=e:t[n.settings.externalIdProp]=e,t}function i(e){for(var t in e)delete e[t]}var r=s.children()[0];n.toggleDropdown=function(){n.open=!n.open},n.checkboxClick=function(e,t){n.setSelectedItem(t),e.stopImmediatePropagation()},n.showEdit=function(e){$(e.currentTarget).parent().hide(),$(e.currentTarget).parent().next().show()},n.editingOption=function(e,t){(13===e.keyCode||27===e.keyCode)&&($(e.currentTarget).parent().parent().hide(),$(e.currentTarget).parent().parent().prev().show(),13===e.keyCode&&n.editOption(t,e.currentTarget.value),e.stopPropagation())},n.editOption=function(e,t){_.forEach(n.options,function(n){n.id===e&&(n.label=t)}),n.events.onItemEdit&&n.events.onItemEdit(e,t)},n.removeOption=function(e,t){$(e.currentTarget).parent().hide(),1===n.settings.selectionLimit&&n.selectedModel.id===t?n.selectedModel={}:n.settings.selectionLimit>1&&(n.selectedModel=n.selectedModel.filter(function(e){return e.id!==t})),n.options=n.options.filter(function(e){return e.id!==t}),n.events.onItemRemove&&n.events.onItemRemove(t),e.stopPropagation()},n.externalEvents={onItemSelect:angular.noop,onItemDeselect:angular.noop,onSelectAll:angular.noop,onDeselectAll:angular.noop,onInitDone:angular.noop,onMaxSelectionReached:angular.noop,onNewItemAdd:angular.noop,onItemEdit:angular.noop,onItemRemove:angular.noop},n.settings={dynamicTitle:!0,scrollable:!1,scrollableHeight:"300px",closeOnBlur:!0,displayProp:"label",idProp:"id",externalIdProp:"id",enableSearch:!1,enableNewItem:!1,enableEdit:!1,alwaysOpened:!1,noSeparators:!1,selectionLimit:0,showCheckAll:!0,showUncheckAll:!0,closeOnSelect:!1,buttonClasses:"btn btn-default",closeOnDeselect:!1,groupBy:o.groupBy||void 0,groupByTextProvider:null,smartButtonMaxItems:0,smartButtonTextConverter:angular.noop},n.texts={checkAll:"Check All",uncheckAll:"Uncheck All",selectionCount:"checked",selectionOf:"/",searchPlaceholder:"Search...",newItemPlaceholder:"New item",buttonDefaultText:"Select",dynamicButtonTextSuffix:"checked"},n.searchFilter=n.searchFilter||"",angular.isDefined(n.settings.groupBy)&&n.$watch("options",function(t){angular.isDefined(t)&&(n.orderedItems=e("orderBy")(t,n.settings.groupBy))}),angular.extend(n.settings,n.extraSettings||[]),angular.extend(n.externalEvents,n.events||[]),angular.extend(n.texts,n.translationTexts),n.singleSelection=1===n.settings.selectionLimit,n.singleSelection&&angular.isArray(n.selectedModel)&&0===n.selectedModel.length&&i(n.selectedModel),n.settings.closeOnBlur&&t.on("click",function(e){for(var t=e.target.parentElement,s=!1;angular.isDefined(t)&&null!==t&&!s;)_.contains(t.className.split(" "),"multiselect-parent")&&!s&&t===r&&(s=!0),t=t.parentElement;s||n.$apply(function(){n.open=!1})}),n.getGroupTitle=function(e){return null!==n.settings.groupByTextProvider?n.settings.groupByTextProvider(e):e},n.getButtonText=function(){if(n.settings.dynamicTitle&&angular.isObject(n.selectedModel)&&(n.selectedModel.length>0||_.keys(n.selectedModel).length>0)){if(n.settings.smartButtonMaxItems>0){var e=[];return angular.forEach(n.options,function(t){if(n.isChecked(n.getPropertyForObject(t,n.settings.idProp))){var s=n.getPropertyForObject(t,n.settings.displayProp),o=n.settings.smartButtonTextConverter(s,t);e.push(o?o:s)}}),n.selectedModel.length>n.settings.smartButtonMaxItems&&(e=e.slice(0,n.settings.smartButtonMaxItems),e.push("...")),e.join(", ")}var t;return t=n.singleSelection?null!==n.selectedModel&&angular.isDefined(n.selectedModel[n.settings.idProp])?1:0:angular.isDefined(n.selectedModel)?n.selectedModel.length:0,0===t?n.texts.buttonDefaultText:t+" "+n.texts.dynamicButtonTextSuffix}return n.texts.buttonDefaultText},n.getPropertyForObject=function(e,t){return angular.isDefined(e)&&e.hasOwnProperty(t)?e[t]:""},n.selectAll=function(){n.deselectAll(!1),n.externalEvents.onSelectAll(),angular.forEach(n.options,function(e){n.setSelectedItem(e[n.settings.idProp],!0)})},n.deselectAll=function(e){e=e||!0,e&&n.externalEvents.onDeselectAll(),n.singleSelection?i(n.selectedModel):n.selectedModel.splice(0,n.selectedModel.length)},n.setSelectedItem=function(e,t){var s=l(e),o=null;if(o=""===n.settings.externalIdProp?_.find(n.options,s):s,n.singleSelection)return i(n.selectedModel),angular.extend(n.selectedModel,o),void n.externalEvents.onItemSelect(o);t=t||!1;var r=-1!==_.findIndex(n.selectedModel,s);!t&&r?(n.selectedModel.splice(_.findIndex(n.selectedModel,s),1),n.externalEvents.onItemDeselect(s)):!r&&(0===n.settings.selectionLimit||n.selectedModel.length<n.settings.selectionLimit)&&(n.selectedModel.push(o),n.externalEvents.onItemSelect(o))},n.isChecked=function(e){return n.singleSelection?null!==n.selectedModel&&angular.isDefined(n.selectedModel[n.settings.idProp])&&n.selectedModel[n.settings.idProp]===l(e)[n.settings.idProp]:-1!==_.findIndex(n.selectedModel,l(e))},n.onNewItemAddKeyDown=function(e){13===e.keyCode&&(n.events.onNewItemAdd(n.newItem),n.newItem="",e.preventDefault())},n.externalEvents.onInitDone()}}}])}();